{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import * as Promise from \"bluebird\";\r\nimport * as mkdirp from \"mkdirp\";\r\nimport * as fs from \"fs\";\r\nimport * as request from \"request\";\r\nimport * as jimp from \"jimp\";\r\nimport * as musique from \"musique\";\r\n\r\nconst nodeID3v23 = require(\"node-id3\");\r\nconst nodeID3v24 = require(\"node-id3v2.4\");\r\n\r\nfunction downloadMp3(songOutput: any, albumOutput: any): Promise<void> {\r\n    let dirName: string, mp3Name: string, artName: string;\r\n\r\n    return new Promise<void>((resolve, reject) => {\r\n        dirName = \"./Songs/\"\r\n            + albumOutput.language + \"/\"\r\n            + albumOutput.year + \"/\"\r\n            + albumOutput.title + \"/\";\r\n        dirName = dirName.replace(/[\\\\:*?\"<>|]/g, \"\");\r\n\r\n        mkdirp(dirName, error => {\r\n            if (error) {\r\n                reject(error);\r\n                return;\r\n            }\r\n\r\n            resolve();\r\n        });\r\n    }).then(() => {\r\n        mp3Name = dirName + songOutput.track + \" - \" + songOutput.title + \".mp3\";\r\n        mp3Name = mp3Name.replace(/[\\\\:*?\"<>|]/g, \"\");\r\n\r\n        // return new Promise<void>((resolve, reject) => {\r\n        //     request.get(songOutput.mp3)\r\n        //         .on(\"error\", error => {\r\n        //             reject(error);\r\n        //         })\r\n        //         .pipe(fs.createWriteStream(mp3Name))\r\n        //         .on(\"finish\", () => {\r\n        //             resolve();\r\n        //         });\r\n        // });\r\n    }).then(() => {\r\n        artName = dirName + songOutput.track + \" - \" + songOutput.title + \".png\";\r\n        artName = artName.replace(/[\\\\:*?\"<>|]/g, \"\");\r\n\r\n        return new Promise<void>((resolve, reject) => {\r\n            request.get(albumOutput.art)\r\n                .on(\"error\", error => {\r\n                    reject(error);\r\n                })\r\n                .pipe(fs.createWriteStream(artName))\r\n                .on(\"finish\", () => {\r\n                    jimp.read(artName)\r\n                        .then(image => {\r\n                            image.resize(512, 512, jimp.RESIZE_NEAREST_NEIGHBOR)\r\n                                .write(artName, error => {\r\n                                    if (error) {\r\n                                        reject(error);\r\n                                        return;\r\n                                    }\r\n\r\n                                    resolve();\r\n                                });\r\n                        })\r\n                        .catch(error => {\r\n                            reject(error);\r\n                        });\r\n                });\r\n        });\r\n    }).then(() => {\r\n        nodeID3v23.removeTags(mp3Name);\r\n\r\n        nodeID3v23.write({\r\n            album: albumOutput.title,\r\n            artist: songOutput.artists.map((artist: any) => artist.title).join(\"; \"),\r\n            genre: songOutput.genre,\r\n            image: artName,\r\n            language: albumOutput.language,\r\n            performerInfo: albumOutput.artists.map((artist: any) => artist.title).join(\"; \"),\r\n            publisher: albumOutput.label,\r\n            title: songOutput.title,\r\n            trackNumber: songOutput.track + \"/4\",\r\n            year: albumOutput.year,\r\n        }, mp3Name);\r\n\r\n        let tag = nodeID3v24.readTag(mp3Name);\r\n        tag.addFrame(\"TDRL\", [\"2017-07-15\"]);\r\n        tag.write();\r\n\r\n        console.log(nodeID3v24.readTag(mp3Name).list());\r\n    }).then(() => {\r\n        return new Promise<void>((resolve, reject) => {\r\n            fs.unlink(artName, error => {\r\n                if (error) {\r\n                    reject(error);\r\n                    return;\r\n                }\r\n\r\n                resolve();\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nmusique.parseSong(\"saavn\", \"https://www.saavn.com/s/song/tamil/Mersal/Neethanae/MiIPaAFCBlc\")\r\n    .then(parser => parser.parse())\r\n    .then(parser => parser.parseAlbum(childParser => childParser.parse()))\r\n    .then(parser => downloadMp3(parser.output, parser.output.album))\r\n    .catch(error => {\r\n        console.error(error);\r\n    });\r\n"]}