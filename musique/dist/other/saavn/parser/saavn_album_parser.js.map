{"version":3,"sources":["../src/other/saavn/parser/saavn_album_parser.ts"],"names":[],"mappings":"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","file":"saavn_album_parser.js","sourcesContent":["import * as Promise from \"bluebird\";\r\nimport * as request from \"request-promise\";\r\nimport * as cheerio from \"cheerio\";\r\n\r\nimport AlbumParser from \"../../../parser/album_parser\";\r\nimport AlbumContent from \"../../../content/album_content\";\r\nimport ArtistInput from \"../../../input/artist_input\";\r\nimport SongInput from \"../../../input/song_input\";\r\nimport ArtistOutput from \"../../../output/artist_output\";\r\nimport SongOutput from \"../../../output/song_output\";\r\n\r\nexport default class SaavnAlbumParser extends AlbumParser {\r\n    protected createContent(): Promise<AlbumContent> {\r\n        return new Promise<AlbumContent>((resolve, reject) => {\r\n            request.get(this.input.url, {\r\n                headers: {\r\n                    \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\",\r\n                    \"Accept-Encoding\": \"gzip, deflate, br\",\r\n                    \"Accept-Language\": \"en,en-US;q=0.8\",\r\n                    \"Cache-Control\": \"max-age=0\",\r\n                    \"Connection\": \"keep-alive\",\r\n                    \"DNT\": \"1\",\r\n                    \"Host\": \"www.saavn.com\",\r\n                    \"Upgrade-Insecure-Requests\": \"1\",\r\n                    \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.101 Safari/537.36\"\r\n                },\r\n                gzip: true\r\n            })\r\n                .then(html => {\r\n                    let content = new AlbumContent();\r\n                    content.html = html;\r\n\r\n                    resolve(content);\r\n                })\r\n                .catch(error => {\r\n                    reject(error);\r\n                });\r\n        });\r\n    }\r\n\r\n    protected contentCreated(): Promise<any> {\r\n        return new Promise<any>(resolve => {\r\n            let $ = cheerio.load(this.content.html);\r\n\r\n            let artistInputs: ArtistInput[] = [];\r\n\r\n            $(\"h2.page-subtitle>a\").each((index, element) => {\r\n                let artistInput = new ArtistInput();\r\n                artistInput.url = $(element).attr(\"href\").replace(\"albums\", \"artist\");\r\n\r\n                artistInputs[index] = artistInput;\r\n            });\r\n\r\n            this.input.artists = artistInputs;\r\n\r\n            let songInputs: SongInput[] = [];\r\n\r\n            $(\"span.title>a\").each((index, element) => {\r\n                let songInput = new SongInput();\r\n                songInput.url = $(element).attr(\"href\");\r\n\r\n                songInputs[index] = songInput;\r\n            });\r\n\r\n            this.input.songs = songInputs;\r\n\r\n            resolve();\r\n        });\r\n    }\r\n\r\n    protected createArt(): Promise<string> {\r\n        return new Promise<string>(resolve => {\r\n            let $ = cheerio.load(this.content.html);\r\n\r\n            resolve($(\"div.art>img\").first().attr(\"src\"));\r\n        });\r\n    }\r\n\r\n    protected createDuration(): Promise<string> {\r\n        return new Promise<string>(resolve => {\r\n            let $ = cheerio.load(this.content.html);\r\n\r\n            resolve($(\"h2.page-subtitle\").first().text().match(/ · .+ · (.+)$/)![1]);\r\n        });\r\n    }\r\n\r\n    protected createLabel(): Promise<string> {\r\n        return new Promise<string>(resolve => {\r\n            let $ = cheerio.load(this.content.html);\r\n\r\n            resolve($(\"p.copyright>a\").last().text());\r\n        });\r\n    }\r\n\r\n    protected createLanguage(): Promise<string> {\r\n        return new Promise<string>(resolve => {\r\n            let $ = cheerio.load(this.content.html);\r\n\r\n            resolve($(\"div.header-context>a\").first().text());\r\n        });\r\n    }\r\n\r\n    protected createReleased(): Promise<string> {\r\n        return new Promise<string>(resolve => {\r\n            let $ = cheerio.load(this.content.html);\r\n\r\n            resolve($(\"p.copyright\").first().text().match(/Released (.+)©/)![1].replace(\",\", \"\"));\r\n        });\r\n    }\r\n\r\n    protected createTitle(): Promise<string> {\r\n        return new Promise<string>(resolve => {\r\n            let $ = cheerio.load(this.content.html);\r\n\r\n            resolve($(\"h1.page-title\").first().text());\r\n        });\r\n    }\r\n\r\n    protected createArtists(): Promise<ArtistOutput[]> {\r\n        return new Promise<ArtistOutput[]>(resolve => {\r\n            let $ = cheerio.load(this.content.html);\r\n\r\n            let artistOutputs: ArtistOutput[] = this.output.artists;\r\n\r\n            if (!artistOutputs) {\r\n                artistOutputs = [];\r\n            }\r\n\r\n            $(\"h2.page-subtitle>a\").each((index, element) => {\r\n                let artistOutput = artistOutputs[index];\r\n\r\n                if (!artistOutput) {\r\n                    artistOutput = new ArtistOutput();\r\n                }\r\n\r\n                artistOutput.url = $(element).attr(\"href\").replace(\"albums\", \"artist\");\r\n                artistOutput.title = $(element).text();\r\n\r\n                artistOutputs[index] = artistOutput;\r\n            });\r\n\r\n            resolve(artistOutputs);\r\n        });\r\n    }\r\n\r\n    protected createSongs(): Promise<SongOutput[]> {\r\n        return new Promise<SongOutput[]>(resolve => {\r\n            let $ = cheerio.load(this.content.html);\r\n\r\n            let songOutputs: SongOutput[] = this.output.songs;\r\n\r\n            if (!songOutputs) {\r\n                songOutputs = [];\r\n            }\r\n\r\n            $(\"span.title>a\").each((index, element) => {\r\n                let songOutput = songOutputs[index];\r\n\r\n                if (!songOutput) {\r\n                    songOutput = new SongOutput();\r\n                }\r\n\r\n                songOutput.url = $(element).attr(\"href\");\r\n                songOutput.title = $(element).text();\r\n\r\n                songOutputs[index] = songOutput;\r\n            });\r\n\r\n            resolve(songOutputs);\r\n        });\r\n    }\r\n}\r\n"]}