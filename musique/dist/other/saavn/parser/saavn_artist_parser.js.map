{"version":3,"sources":["../src/other/saavn/parser/saavn_artist_parser.ts"],"names":[],"mappings":"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","file":"saavn_artist_parser.js","sourcesContent":["import * as Promise from \"bluebird\";\r\nimport * as request from \"request-promise\";\r\nimport * as cheerio from \"cheerio\";\r\n\r\nimport ArtistParser from \"../../../parser/artist_parser\";\r\nimport ArtistContent from \"../../../content/artist_content\";\r\nimport AlbumOutput from \"../../../output/album_output\";\r\nimport SongOutput from \"../../../output/song_output\";\r\nimport AlbumParser from \"../../../parser/album_parser\";\r\nimport SongParser from \"../../../parser/song_parser\";\r\nimport AlbumInput from \"../../../input/album_input\";\r\nimport SongInput from \"../../../input/song_input\";\r\n\r\nexport default class SaavnArtistParser extends ArtistParser {\r\n    private albumPageHtmls: string[] = [];\r\n    private songPageHtmls: string[] = [];\r\n\r\n    protected createContent(): Promise<ArtistContent> {\r\n        return new Promise<ArtistContent>((resolve, reject) => {\r\n            request.get(this.input.url, {\r\n                headers: {\r\n                    \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\",\r\n                    \"Accept-Encoding\": \"gzip, deflate, br\",\r\n                    \"Accept-Language\": \"en,en-US;q=0.8\",\r\n                    \"Cache-Control\": \"max-age=0\",\r\n                    \"Connection\": \"keep-alive\",\r\n                    \"DNT\": \"1\",\r\n                    \"Host\": \"www.saavn.com\",\r\n                    \"Upgrade-Insecure-Requests\": \"1\",\r\n                    \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.101 Safari/537.36\"\r\n                },\r\n                gzip: true\r\n            })\r\n                .then(html => {\r\n                    let content = new ArtistContent();\r\n                    content.html = html;\r\n\r\n                    resolve(content);\r\n                })\r\n                .catch(error => {\r\n                    reject(error);\r\n                });\r\n        });\r\n    }\r\n\r\n    protected contentCreated(): Promise<void> {\r\n        return new Promise<void>(resolve => {\r\n            this.input.albums = [];\r\n            this.input.songs = [];\r\n\r\n            resolve();\r\n        });\r\n    }\r\n\r\n    protected createTitle(): Promise<string> {\r\n        return new Promise<string>(resolve => {\r\n            let $ = cheerio.load(this.content.html);\r\n\r\n            resolve($(\"h1.page-title\").first().text());\r\n        });\r\n    }\r\n\r\n    protected createAlbums(): Promise<AlbumOutput[]> {\r\n        return this.createAlbumPage()\r\n            .then(() => {\r\n                let albumOutputs = this.output.albums;\r\n\r\n                if (!albumOutputs) {\r\n                    albumOutputs = [];\r\n                }\r\n\r\n                for (let albumPageHtml of this.albumPageHtmls) {\r\n                    let $ = cheerio.load(albumPageHtml);\r\n\r\n                    $(\"h3.title>a\").each((index, element) => {\r\n                        let albumOutput = albumOutputs[index];\r\n\r\n                        if (!albumOutput) {\r\n                            albumOutput = new AlbumOutput();\r\n                        }\r\n\r\n                        albumOutput.url = $(element).attr(\"href\");\r\n                        albumOutput.title = $(element).text();\r\n\r\n                        albumOutputs[index] = albumOutput;\r\n                    })\r\n                }\r\n\r\n                return albumOutputs;\r\n            });\r\n    }\r\n\r\n    protected createSongs(): Promise<SongOutput[]> {\r\n        return this.createSongPage()\r\n            .then(() => {\r\n                let songOutputs = this.output.songs;\r\n\r\n                if (!songOutputs) {\r\n                    songOutputs = [];\r\n                }\r\n\r\n                for (let songPageHtml of this.songPageHtmls) {\r\n                    let $ = cheerio.load(songPageHtml);\r\n\r\n                    $(\"span.title>a\").each((index, element) => {\r\n                        let songOutput = songOutputs[index];\r\n\r\n                        if (!songOutput) {\r\n                            songOutput = new SongOutput();\r\n                        }\r\n\r\n                        songOutput.url = $(element).attr(\"href\");\r\n                        songOutput.title = $(element).text();\r\n\r\n                        songOutputs[index] = songOutput;\r\n                    })\r\n                }\r\n\r\n                return songOutputs;\r\n            });\r\n    }\r\n\r\n    public parseAlbums(outputsParser?: (childParser: AlbumParser, index: number) => Promise<any>,\r\n                       ...indexes: number[]): Promise<this> {\r\n        let promise = new Promise<any>(resolve => {\r\n            resolve();\r\n        });\r\n\r\n        if (indexes.length == 0) {\r\n            promise = promise\r\n                .then(() => this.createAlbumPage());\r\n        } else {\r\n            let lastIndex = indexes.sort()[indexes.length - 1];\r\n\r\n            for (let i = this.albumPageHtmls.length; i <= Math.floor(lastIndex / 12) + 1; i++) {\r\n                promise = promise\r\n                    .then(() => this.createAlbumPage());\r\n            }\r\n        }\r\n\r\n        return promise\r\n            .then(() => super.parseAlbums(outputsParser, ...indexes));\r\n    }\r\n\r\n    public parseSongs(outputsParser?: (childParser: SongParser, index: number) => Promise<any>,\r\n                      ...indexes: number[]): Promise<this> {\r\n        let promise = new Promise<any>(resolve => {\r\n            resolve();\r\n        });\r\n\r\n        if (indexes.length == 0) {\r\n            promise = promise\r\n                .then(() => this.createSongPage());\r\n        } else {\r\n            let lastIndex = indexes.sort()[indexes.length - 1];\r\n\r\n            for (let i = this.songPageHtmls.length; i <= Math.floor(lastIndex / 10) + 1; i++) {\r\n                promise = promise\r\n                    .then(() => this.createSongPage());\r\n            }\r\n        }\r\n\r\n        return promise\r\n            .then(() => super.parseSongs(outputsParser, ...indexes));\r\n    }\r\n\r\n    private createAlbumPage(): Promise<void> {\r\n        return request.get(this.input.url.replace(\"-artist\", \"-albums\") + \"?page=\" + this.albumPageHtmls.length, {\r\n            headers: {\r\n                \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\",\r\n                \"Accept-Encoding\": \"gzip, deflate, br\",\r\n                \"Accept-Language\": \"en,en-US;q=0.8\",\r\n                \"Cache-Control\": \"max-age=0\",\r\n                \"Connection\": \"keep-alive\",\r\n                \"DNT\": \"1\",\r\n                \"Host\": \"www.saavn.com\",\r\n                \"Upgrade-Insecure-Requests\": \"1\",\r\n                \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.101 Safari/537.36\"\r\n            },\r\n            gzip: true\r\n        })\r\n            .then(html => {\r\n                this.albumPageHtmls.push(html);\r\n\r\n                let $ = cheerio.load(html);\r\n\r\n                $(\"h3.title>a\").each((index, element) => {\r\n                    let albumInput = new AlbumInput();\r\n                    albumInput.url = $(element).attr(\"href\");\r\n\r\n                    this.input.albums.push(albumInput);\r\n                });\r\n            });\r\n    }\r\n\r\n    private createSongPage(): Promise<void> {\r\n        return request.get(this.input.url.replace(\"-artist\", \"-songs\") + \"?page=\" + this.songPageHtmls.length, {\r\n            headers: {\r\n                \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\",\r\n                \"Accept-Encoding\": \"gzip, deflate, br\",\r\n                \"Accept-Language\": \"en,en-US;q=0.8\",\r\n                \"Cache-Control\": \"max-age=0\",\r\n                \"Connection\": \"keep-alive\",\r\n                \"DNT\": \"1\",\r\n                \"Host\": \"www.saavn.com\",\r\n                \"Upgrade-Insecure-Requests\": \"1\",\r\n                \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.101 Safari/537.36\"\r\n            },\r\n            gzip: true\r\n        })\r\n            .then(html => {\r\n                this.songPageHtmls.push(html);\r\n\r\n                let $ = cheerio.load(html);\r\n\r\n                $(\"span.title>a\").each((index, element) => {\r\n                    let songInput = new SongInput();\r\n                    songInput.url = $(element).attr(\"href\");\r\n\r\n                    this.input.songs.push(songInput);\r\n                });\r\n            });\r\n    }\r\n}\r\n"]}