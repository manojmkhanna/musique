{"version":3,"sources":["../src/other/deezer/parser/deezer_album_parser.ts"],"names":[],"mappings":"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","file":"deezer_album_parser.js","sourcesContent":["import * as Promise from \"bluebird\";\r\nimport * as request from \"request\";\r\nimport * as cheerio from \"cheerio\";\r\nimport * as moment from \"moment\";\r\n\r\nimport AlbumParser from \"../../../parser/album_parser\";\r\nimport AlbumContent from \"../../../content/album_content\";\r\nimport DeezerConstants from \"../deezer_constants\";\r\nimport ArtistInput from \"../../../input/artist_input\";\r\nimport SongInput from \"../../../input/song_input\";\r\nimport ArtistOutput from \"../../../output/artist_output\";\r\nimport SongOutput from \"../../../output/song_output\";\r\n\r\nexport default class DeezerAlbumParser extends AlbumParser {\r\n    protected createContent(): Promise<AlbumContent> {\r\n        return new Promise<AlbumContent>((resolve, reject) => {\r\n            request(this.input.url, DeezerConstants.REQUEST_OPTIONS, (error, response, body) => {\r\n                if (error) {\r\n                    reject(error);\r\n                    return;\r\n                }\r\n\r\n                let content: AlbumContent = new AlbumContent();\r\n                content.html = body;\r\n\r\n                resolve(content);\r\n            });\r\n        });\r\n    }\r\n\r\n    protected contentCreated(): Promise<void> {\r\n        return new Promise<void>(resolve => {\r\n            let json: any = JSON.parse(this.content.html.match(/__DZR_APP_STATE__ = (.+?)<\\/script>/)![1]);\r\n\r\n            let artistInputs: ArtistInput[] = [];\r\n\r\n            for (let i = 0; i < json.DATA.ARTISTS.length; i++) {\r\n                let artistInput: ArtistInput = new ArtistInput();\r\n                artistInput.url = \"http://www.deezer.com/en/artist/\" + json.DATA.ARTISTS[i].ART_ID;\r\n\r\n                artistInputs[i] = artistInput;\r\n            }\r\n\r\n            this.input.artists = artistInputs;\r\n\r\n            let songInputs: SongInput[] = [];\r\n\r\n            for (let i = 0; i < json.SONGS.data.length; i++) {\r\n                let songInput: SongInput = new SongInput();\r\n                songInput.url = \"http://www.deezer.com/en/track/\" + json.SONGS.data[i].SNG_ID;\r\n\r\n                songInputs[i] = songInput;\r\n            }\r\n\r\n            this.input.songs = songInputs;\r\n\r\n            resolve();\r\n        });\r\n    }\r\n\r\n    protected createArt(): Promise<string> {\r\n        return new Promise<string>(resolve => {\r\n            let $ = cheerio.load(this.content.html);\r\n\r\n            resolve($(\"img#naboo_album_image\").first().attr(\"src\").replace(\"200x200\", \"512x512\"));\r\n        });\r\n    }\r\n\r\n    protected createDate(): Promise<string> {\r\n        return new Promise<string>(resolve => {\r\n            let $ = cheerio.load(this.content.html);\r\n\r\n            resolve(moment($(\"span#naboo_album_head_style\")\r\n                .first().text().match(/\\| (.+?)\\t+/)![1], \"DD-MM-YYYY\").format(\"YYYY-MM-DD\"));\r\n        });\r\n    }\r\n\r\n    protected createLabel(): Promise<string> {\r\n        return new Promise<string>(resolve => {\r\n            let $ = cheerio.load(this.content.html);\r\n\r\n            resolve($(\"div.naboo-album-label\").first().text().match(/\\| \\t+(.+?)\\t+/)![1]);\r\n        });\r\n    }\r\n\r\n    protected createLanguage(): Promise<string> {\r\n        return new Promise<string>(resolve => {\r\n            resolve(\"English\");\r\n        });\r\n    }\r\n\r\n    protected createTitle(): Promise<string> {\r\n        return new Promise<string>(resolve => {\r\n            let $ = cheerio.load(this.content.html);\r\n\r\n            resolve($(\"h1#naboo_album_title\").first().text().trim());\r\n        });\r\n    }\r\n\r\n    protected createYear(): Promise<string> {\r\n        return new Promise<string>(resolve => {\r\n            let $ = cheerio.load(this.content.html);\r\n\r\n            resolve($(\"div.naboo-album-label\").first().text().match(/\\t+(\\d+?) \\|/)![1]);\r\n        });\r\n    }\r\n\r\n    protected createArtists(): Promise<ArtistOutput[]> {\r\n        return new Promise<ArtistOutput[]>(resolve => {\r\n            let json: any = JSON.parse(this.content.html.match(/__DZR_APP_STATE__ = (.+?)<\\/script>/)![1]);\r\n\r\n            let artistOutputs: ArtistOutput[] = this.output.artists;\r\n\r\n            if (!artistOutputs) {\r\n                artistOutputs = [];\r\n            }\r\n\r\n            for (let i = 0; i < json.DATA.ARTISTS.length; i++) {\r\n                let artistOutput: ArtistOutput = artistOutputs[i];\r\n\r\n                if (!artistOutput) {\r\n                    artistOutput = new ArtistOutput();\r\n                }\r\n\r\n                artistOutput.url = \"http://www.deezer.com/en/artist/\" + json.DATA.ARTISTS[i].ART_ID;\r\n                artistOutput.title = json.DATA.ARTISTS[i].ART_NAME;\r\n\r\n                artistOutputs[i] = artistOutput;\r\n            }\r\n\r\n            resolve(artistOutputs);\r\n        });\r\n    }\r\n\r\n    protected createSongs(): Promise<SongOutput[]> {\r\n        return new Promise<SongOutput[]>(resolve => {\r\n            let json: any = JSON.parse(this.content.html.match(/__DZR_APP_STATE__ = (.+?)<\\/script>/)![1]);\r\n\r\n            let songOutputs: SongOutput[] = this.output.songs;\r\n\r\n            if (!songOutputs) {\r\n                songOutputs = [];\r\n            }\r\n\r\n            for (let i = 0; i < json.SONGS.data.length; i++) {\r\n                let songOutput: SongOutput = songOutputs[i];\r\n\r\n                if (!songOutput) {\r\n                    songOutput = new SongOutput();\r\n                }\r\n\r\n                songOutput.url = \"http://www.deezer.com/en/track/\" + json.SONGS.data[i].SNG_ID;\r\n                songOutput.title = json.SONGS.data[i].SNG_TITLE;\r\n\r\n                songOutputs[i] = songOutput;\r\n            }\r\n\r\n            resolve(songOutputs);\r\n        });\r\n    }\r\n}\r\n"]}